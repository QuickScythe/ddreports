<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Form</title>
    <script>

        function updateDeliveriesSection(offerNum){
            const deliveries = document.getElementById(`offer${offerNum}deliveries`).value;
            const additionalField = document.getElementById(`offer${offerNum}deliveriesSection`);
            var text = "<h4>Deliveries</h4>";
            for (var i = 0; i < deliveries; i++) {
                text += "<h5>Delivery " + (i + 1) + "</h5>";
                text += `
                    <label for="offers${offerNum}.deliveries${i}.store">Store:</label>
                    <input type="text" id="offer${offerNum}.deliveries${i}.store" name="offers[${offerNum}].deliveries[${i}].store" /><br/>

                    <label for="offers${offerNum}.deliveries${i}.tips">Tips:</label>
                    <input type="number" id="offers${offerNum}.delivery${i}.tips" name="offers[${offerNum}].deliveries[${i}].tips" /><br/>
                `;
            }
            additionalField.innerHTML = text;
        }

        function updateOfferForm() {
            const offerNum = document.getElementById('offers').value;
            const additionalField = document.getElementById('additionalField');

            if (offerNum > 0) {
                var text = "<h4>Offers</h4>";
                for (var i = 0; i < offerNum; i++) {
                    text += "<h5>Offer " + (i + 1) + "</h5>";
                    text += `
                        <label for="offers${i}.basePay">Base Pay:</label>
                        <input type="number" id="offers${i}.basePay" name="offers[${i}].basePay" /><br/>

                        <label for="offers${i}deliveries">Deliveries:</label>
                        <input type="number" id="offer${i}deliveries" name="offer${i}deliveries" oninput="updateDeliveriesSection(${i})" /><br/>

                        <div id="offer${i}deliveriesSection"></div>
                    `;
                }
                additionalField.innerHTML = text;
            } else {
                additionalField.innerHTML = '';
            }
        }
    </script>
    <link th:href="@{/style.css}" rel="stylesheet">
</head>
<body>
<form th:action="@{/form/save-dash}" th:object="${form}" method="post">
    <label for="start">Start Time:</label>
    <input type="datetime-local" id="start" th:field="*{startTime}" /><br/>
    <label for="end">End Time:</label>
    <input type="datetime-local" id="end" th:field="*{endTime}" /><br/>
    <label for="active">Active Time (Minutes):</label>
    <input type="number" id="active" th:field="*{activeTime}" /><br/>

    <label for="miles">Miles:</label>
    <input type="number" id="miles" th:field="*{miles}" /><br/>

    <label for="offers">Offers:</label>
    <input type="number" id="offers" th:field="*{offers}" oninput="updateOfferForm()"/><br/>
    <div id="additionalField"></div>
    <button type="submit">Submit</button>
</form>
</body>
</html>